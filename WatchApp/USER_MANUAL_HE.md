# מדריך למשתמש - שעון חכם PIC24
## פרויקט גמר - מבוא למערכות משובצות

---

## תוכן עניינים
1. [הפעלה ראשונית](#הפעלה-ראשונית)
2. [תצוגות שעון](#תצוגות-שעון)
3. [מערכת תפריטים](#מערכת-תפריטים)
4. [כיוון שעה ותאריך](#כיוון-שעה-ותאריך)
5. [מעורר](#מעורר)
6. [טיימר פומודורו](#טיימר-פומודורו)
7. [פתרון תקלות](#פתרון-תקלות)

---

## הפעלה ראשונית

### חיבור והפעלה
1. חבר את לוח ה-PIC24 Curiosity למחשב דרך USB
2. טען את הקוד למיקרו-בקר דרך MPLAB X
3. השעון יופעל אוטומטית עם הגדרות ברירת מחדל:
   - שעה: 12:00:00
   - תאריך: 01/01
   - תצוגה: דיגיטלית
   - פורמט: 12 שעות
   - מעורר: כבוי

### רכיבי חומרה
- **S1**: כפתור ניווט/למטה
- **S2**: כפתור אישור/Enter
- **פוטנציומטר**: גלילה והזנת ערכים
- **LED1**: משוב חזותי ל-S1
- **LED2**: משוב חזותי ל-S2
- **מסך OLED**: תצוגה 96x96 פיקסלים

---

## תצוגות שעון

השעון כולל 3 תצוגות שונות. למעבר בין תצוגות, לחץ **S2** במצב תצוגת שעון.

### 1. תצוגה דיגיטלית
```
    ┌──────────────┐
    │   24/01  🔔  │
    │              │
    │   08:24:35   │
    │      AM      │
    │              │
    └──────────────┘
```
**תכונות:**
- ספרות גדולות וברורות
- תצוגת שניות דינמית
- תאריך בפינה העליונה
- אינדיקטור AM/PM (במצב 12 שעות)
- אייקון מעורר (כאשר פעיל)

### 2. תצוגה אנלוגית
```
    ┌──────────────┐
    │ 24/01     🔔 │
    │     12       │
    │  9  │  3     │
    │     │        │
    │     6   AM   │
    └──────────────┘
```
**תכונות:**
- מחוגים גרפיים (שעות, דקות, שניות)
- מחוג שעות: קצר ועבה
- מחוג דקות: בינוני
- מחוג שניות: ארוך ודק
- 12 שנתות לסימון שעות
- אינדיקטור AM/PM

### 3. תצוגה בינארית
```
    ┌──────────────┐
    │ 24/01     🔔 │
    │ 8 ● ○ ● ●   │
    │ 4 ○ ○ ○ ●   │
    │ 2 ○ ● ● ○   │
    │ 1 ● ○ ● ○   │
    │   H H M M   │
    └──────────────┘
```
**תכונות:**
- ספרות BCD בינריות
- צבעים שונים: שעות (ציאן), דקות (כתום), שניות (מגנטה)
- ● = 1, ○ = 0
- אסתטיקה ייחודית ומיוחדת

**החלפת תצוגות:**
- לחץ **S2** במצב שעון רגיל למעבר בין התצוגות
- ה-LED2 יידלק לרגע כאישור

---

## מערכת תפריטים

### כניסה לתפריט
**לחיצה ארוכה (>2 שניות) על S1**
- ה-LED1 יידלק
- תוצג מסך התפריט הראשי

### יציאה מהתפריט
ישנן 3 דרכים לצאת מהתפריט:
1. **הפיכת השעון** - סובב את הלוח כך שה-OLED פונה למטה
2. **ניעור** - נענע את הלוח 3 פעמים
3. **בחירה בפומודורו** - תעבור למצב טיימר

### ניווט בתפריט
- **S1**: מעבר לפריט הבא (ציקלי)
- **S2**: בחירה/אישור
- **פוטנציומטר**: שינוי ערכים (במסכי עריכה)
- השעה המדויקת מוצגת תמיד בפינה העליונה

### תפריט ראשי
```
┌────────────────────┐
│      MENU          │
├────────────────────┤
│ ▶ Display Mode     │
│   Time Format      │
│   Set Time         │
│   Set Date         │
│   Set Alarm        │
│   Alarm On/Off     │
│   Pomodoro         │
└────────────────────┘
```

---

## כיוון שעה ותאריך

### 1. שינוי מצב תצוגה (Display Mode)
1. בחר "Display Mode" בתפריט הראשי
2. לחץ S1 למעבר בין: דיגיטלי / אנלוגי / בינארי
3. לחץ S2 לאישור ו חזרה לתפריט

### 2. שינוי פורמט שעה (Time Format)
1. בחר "Time Format" בתפריט הראשי
2. לחץ S1 למעבר בין: 12 Hour / 24 Hour
3. לחץ S2 לאישור

### 3. כיוון שעה (Set Time)
```
┌────────────────────┐
│    SET TIME        │
│                    │
│    [08]:24:35      │
│     ↑              │
│ S1:Field Pot:Value │
│   S2:Confirm       │
└────────────────────┘
```
**הוראות:**
1. בחר "Set Time"
2. השדה הראשון (שעות) מודגש
3. **S1**: מעבר בין שדות (שעות → דקות → שניות)
4. **פוטנציומטר**: שנה ערך השדה המסומן
5. **S2**: שמור וחזור לתפריט

**טווחי ערכים:**
- שעות: 0-23 (או 1-12 במצב 12 שעות)
- דקות: 0-59
- שניות: 0-59

### 4. כיוון תאריך (Set Date)
```
┌────────────────────┐
│    SET DATE        │
│                    │
│    [01]/12         │
│     ↑              │
│ S1:Field Pot:Value │
│   S2:Confirm       │
└────────────────────┘
```
**הוראות:**
1. בחר "Set Date"
2. **S1**: מעבר בין יום לחודש
3. **פוטנציומטר**: שנה ערך
4. **S2**: שמור

**טווחי ערכים:**
- יום: 1-28/30/31 (לפי חודש)
- חודש: 1-12
- פברואר: תמיד 28 ימים (ללא שנה מעוברת)

---

## מעורר

### הגדרת מעורר
```
┌────────────────────┐
│    SET ALARM       │
│                    │
│    [07]:30         │
│     ↑              │
│ S1:Field Pot:Value │
│   S2:Confirm       │
└────────────────────┘
```
**הוראות:**
1. בחר "Set Alarm"
2. **S1**: מעבר בין שעה לדקה
3. **פוטנציומטר**: שנה ערך
4. **S2**: שמור (המעורר יופעל אוטומטית)
5. אייקון 🔔 יופיע בתצוגה

### הפעלה/כיבוי מעורר
1. בחר "Alarm On/Off"
2. **S1**: החלף בין מופעל/כבוי
3. **S2**: חזור לתפריט

### צלצול מעורר
כאשר המעורר מופעל:
- המסך יהבהב (תצוגה inverse)
- התדירות: פעם בשנייה
- משך: עד 20 שניות או עד כיבוי

**כיבוי מעורר:**
- לחץ **S1** או **S2** במצב תצוגת שעון
- הפוך את השעון
- נענע את השעון

**כיבוי אוטומטי:**
- לאחר 20 שניות המעורר יכבה מעצמו

---

## טיימר פומודורו

### מה זה פומודורו?
טכניקת ניהול זמן המבוססת על:
- 25 דקות עבודה מרוכזת
- 5 דקות הפסקה קצרה
- 15 דקות הפסקה ארוכה (אחרי 4 מחזורים)

### הפעלת הפומודורו
1. בתפריט הראשי בחר "Pomodoro"
2. המסך יעבור לטיימר פומודורו

### תצוגת פומודורו
```
┌────────────────────┐
│   WORK SESSION     │
│                    │
│     25:00          │
│                    │
│ ████████░░░░░░░░   │
│ 🍅 🍅 ░ ░          │
│                    │
│ S1:Reset S2:Start  │
└────────────────────┘
```

**רכיבי תצוגה:**
- כותרת מצב: WORK / SHORT BREAK / LONG BREAK
- ספירה לאחור: MM:SS
- סרגל התקדמות
- מונה מחזורים (עגבניות 🍅)
- הוראות בתחתית

### שליטה בפומודורו
- **S2**: הפעל/השהה
- **S1**: אפס טיימר
- **לחיצה ארוכה S1**: חזור לתפריט
- **הפיכה/ניעור**: חזור לתצוגת שעון

### מעברים אוטומטיים
כאשר הטיימר מגיע ל-00:00:
1. מחזור עבודה → הפסקה קצרה (5 דק')
2. הפסקה קצרה → מחזור עבודה הבא
3. מחזור 4 → הפסקה ארוכה (15 דק')
4. הפסקה ארוכה → מחזור 1

---

## פתרון תקלות

### השעה לא מתקדמת
✓ ודא שה-Timer ISR פועל
✓ בדוק שה-Timer2 מוגדר נכון
✓ ודא שהתוכנה עברה קומפילציה

### הכפתורים לא מגיבים
✓ בדוק את ה-LEDs - האם נדלקים?
✓ ודא שהדה-באונס פועל (המתן 25ms בין לחיצות)
✓ בדוק שה-TRISA מוגדר נכון

### תצוגה לא מתעדכנת
✓ ודא שה-OLED מחובר
✓ בדוק את ה-SPI communication
✓ ודא שדגל needs_redraw מוגדר

### הפוטנציומטר קופץ (jitter)
✓ ההיסטרזיס מוגדרת ל-30 (ניתן להגדיל ל-40)
✓ ודא שה-ADC מוגדר נכון
✓ הוסף קבל פילטר אם נדרש

### המעורר לא מצלצל
✓ ודא שהמעורר מופעל (אייקון 🔔)
✓ בדוק ש-Alarm_Check() נקרא כל שנייה
✓ ודא שהשעה נכונה

### האקסלרומטר לא מזהה תנועה
✓ בדוק את ה-I2C communication
✓ ודא ש-ACCEL3_Initialize() הופעל
✓ כוון את סף הזיהוי במידת הצורך

---

## מפרט טכני

### מבנה קבצים
```
watch_project/
├── shared/
│   ├── watch_types.h       # הגדרות טיפוסים
│   ├── watch_state.h       # ניהול מצב גלובלי
│   └── watch_state.c
├── watchCore/
│   ├── watch_timer.c       # Timer ISR (1Hz)
│   ├── timekeeper.c        # ניהול זמן ותאריך
│   └── alarm.c             # לוגיקת מעורר
├── watchFaces/
│   ├── digital_face.c      # תצוגה דיגיטלית
│   ├── analog_face.c       # תצוגה אנלוגית
│   └── binary_face.c       # תצוגה בינארית
├── watchMenu/
│   └── menu.c              # מערכת תפריטים
├── watchInput/
│   ├── buttons.c           # טיפול בכפתורים
│   ├── potentiometer.c     # קריאת פוטנציומטר
│   └── accel_input.c       # קריאת accelerometer
├── pomodoroTimer/
│   └── pomodoro.c          # טיימר פומודורו
└── watch_main.c            # לולאה ראשית
```

### פלטת צבעים
- **רקע**: שחור (0x0000)
- **ראשי**: ציאן (0x07FF)
- **משני**: כתום (0xFD20)
- **הדגשה**: מגנטה (0xF81F)
- **אזהרה**: אדום (0xF800)
- **הצלחה**: ירוק (0x07E0)
- **עמום**: אפור (0x8410)

### קצבי עדכון
- **Timer ISR**: 1Hz (דיוק: ±0.1%)
- **עדכון תצוגה**: כל שנייה
- **דה-באונס כפתורים**: 25ms
- **היסטרזיס פוטנציומטר**: 30

### מפרטי חומרה
- **מיקרו-בקר**: PIC24FJ256GA705
- **תדר שעון**: 8MHz (4MHz instruction cycle)
- **מסך**: OLED 96x96 RGB565
- **Timer**: Timer2 עם compare match
- **ADC**: 10-bit, channel AN8

---

## יצירת קשר ותמיכה
לשאלות ובעיות טכניות, פנה למרצה או למתרגל של הקורס.

**בהצלחה! 🎓**

---
*מדריך זה נוצר כחלק מפרויקט הגמר בקורס "מבוא למערכות משובצות"*
*מכון טכנולוגי - אביב 2026*
